(window.webpackJsonp=window.webpackJsonp||[]).push([[253],{570:function(s,a,t){"use strict";t.r(a);var e=t(11),n=function(s){s.options.__data__block__={mermaid_382ee227:"stateDiagram\n\t[*] --\x3e branch\n\tbranch --\x3e deploy\n\tdeploy --\x3e rsync\n  rsync --\x3e\tkeepfive\n\tkeepfive --\x3e ln\n\t\n\tbranch --\x3e rollback\n\trollback --\x3e ID\n\tID --\x3e default\n\tdefault --\x3e lastbuild\n\tlastbuild --\x3e ln\n\t\n  ID --\x3e nodefault\n  nodefault --\x3e IDbuild\n  IDbuild --\x3e ln\n"}},r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("上周在Jenkins中文社区做了一次关于回滚那些事儿的分享，因为要准备这样一次分享，所以很多以前放下的事情，又都捡拾起来了，瞬间又有了不少奇思妙想出来，这种收获，是不进行这次经历无法获取的，分享常常使我更加成长，尽管分享的东西，已经是自己所熟悉的，熟悉的东西多加巩固，就会有意外收获。")]),s._v(" "),t("p",[s._v("曾经我一直以为，Jenkins对比所谓Gitlab的cicd，以及drone等的发布工具，可能在对发布的历史版本回滚的操作上，有天生不足（前边提到的两者都是直接基于git自身的版本控制进行发布，回滚的时候也直接基于历史版本重新发布即可），我一度以为这是Jenkins无尽美好中的唯一缺憾。")]),s._v(" "),t("p",[s._v("后来工作中接触到walle的部署，当我了解了walle的发布思路之后，就像忽然打开了一扇大门一样，忽然觉得Jenkins同样可以借鉴这样一个思路来进行发布的工作，于是，在工作之余，我做了五大实验：")]),s._v(" "),t("ul",[t("li",[s._v("基于freestyle的定制化单机版本发布回滚配置管理")]),s._v(" "),t("li",[s._v("基于pipeline的定制化单机版本发布回滚配置管理")]),s._v(" "),t("li",[s._v("基于freestyle结合ansible的多主机批量发布回滚配置管理")]),s._v(" "),t("li",[s._v("基于pipeline结合ansible的多主机批量发布回滚配置管理")]),s._v(" "),t("li",[s._v("基于pipeline结合优化版ansible的多主机批量发布回滚配置管理")])]),s._v(" "),t("p",[s._v("今天将针对这些方案一一解析与分享，本文将分享 "),t("code",[s._v("基于freestyle的定制化单机版本发布回滚配置管理")]),s._v("和 "),t("code",[s._v("基于freestyle结合ansible的多主机批量发布回滚配置管理")]),s._v(" 这两种。")]),s._v(" "),t("p",[s._v("现在，进入正题。")]),s._v(" "),t("h2",{attrs:{id:"_1-思路整理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-思路整理"}},[s._v("#")]),s._v(" 1，思路整理")]),s._v(" "),t("p",[s._v("如果是发布PHP项目：")]),s._v(" "),t("ol",[t("li",[s._v("同步到远端的版本目录，目录使用"),t("code",[s._v("时间 + build id")]),s._v("命名")]),s._v(" "),t("li",[s._v("将新的应用版本软链到项目root目录")]),s._v(" "),t("li",[s._v("确保远程目录只保留五次(可自定义次数)历史")])]),s._v(" "),t("p",[s._v("如果是回滚：")]),s._v(" "),t("ol",[t("li",[s._v("构建参数当中添加一个回滚ID，默认情况下，将回滚到上次构建")]),s._v(" "),t("li",[s._v("如果输入自定义ID，则回滚到对应构建")]),s._v(" "),t("li",[s._v("支持灵活在五次构建内回滚")])]),s._v(" "),t("p",[s._v("这一思路的流程图大概如下：")]),s._v(" "),t("div",{staticClass:"center-container"},[t("Mermaid",{attrs:{id:"mermaid_382ee227",graph:s.$dataBlock.mermaid_382ee227}})],1),t("p",[s._v("现在通过实际例子来实现一下上边这个思路，大概将进行四个实验，或者更多，首先是类前端项目发布，静态部署，PHP项目等都可采用这种方案。")]),s._v(" "),t("h2",{attrs:{id:"_2-自由风格单机部署回滚示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-自由风格单机部署回滚示例"}},[s._v("#")]),s._v(" 2，自由风格单机部署回滚示例")]),s._v(" "),t("p",[s._v("创建一个自由风格的测试项目，核心当然是在参数化的配置，以及脚本的灵活定义，因此这里就展示这两个部分，先看参数化部分配置：")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/f4d16fe913a12936.jpg",alt:"image"}})]),s._v(" "),t("p",[s._v("定义三个参数，分别对应上边流程图中的三个节点，首先通过分支branch进行下发，接着通过mode进行部署或者回滚，如果是回滚，则再针对版本ID进行一下判断即可。")]),s._v(" "),t("p",[t("code",[s._v("脚本内容：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##set color##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("echoRed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;31m'")]),s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoGreen() { echo $'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;32m'\"")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoYellow() { echo $'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;33m'\"")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\n##set color##\nsource /etc/profile\nproject=\"")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_port="')]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_user="')]),s._v("root"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_ip="')]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.3")]),s._v(".0.42"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nDate='),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+%Y%m%d%H%M%S"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('\nproject_dir="')]),s._v("/data/www/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nversion_dir="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Date}")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"\ncat > keepfive.sh << 'EOF'\nfile_path=\"")]),s._v("/release/admin"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nwhile true;do\nA='),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nB="),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lrX $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nif [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" -gt 5 ];then rm -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_path}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$B")]),s._v(";else break;fi;done\nEOF\nif [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mode")]),s._v(' == "')]),s._v("deploy"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n    echoYellow "')]),s._v("创建远程主机上的版本目录 ："),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_dir}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_dir}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在创建远程主机上的版本目录时出错，故而退出构建，可联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoYellow "')]),s._v("将代码同步到远程主机版本目录"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    rsync -az -e "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\" --exclude='Jenkinsfile' --exclude='keepfive.sh' --delete "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_dir")]),s._v("/\n    [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行同步代码到版本目录时出错，故而退出构建，可联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("将代码同步到远程主机版本目录成功！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("将项目部署到生产目录"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -snf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_dir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在将项目部署到生产目录时出错，故而退出构建，可联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("将项目部署到生产目录成功！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("使版本目录保持五个版本历史"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(" sh < keepfive.sh\n    [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行版本清理时出错，将会影响回滚，故而退出构建，可联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("执行版本清理成功！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("同步版本号到本地"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ ! -d /root/.jenkins/version/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v(" ] && mkdir -p /root/.jenkins/version/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("\n    ssh -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" > /root/.jenkins/version/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v('/version.log\n    echoGreen "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoGreen "')]),s._v("上线部署完成！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoGreen "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nelse\n    if [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' == "')]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n        echoYellow "')]),s._v("选择回滚的版本是默认，将回滚到上次制品，回滚即将进行"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n2 /root/.jenkins/version/$project/version.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -n1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        ssh -p '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -snf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行回滚时出错，故而退出构建，可立即联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n        echoGreen "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echoGreen "')]),s._v("项目已回滚完成！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echoGreen "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    else\n        echoYellow "')]),s._v("选择回滚的版本是："),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v("，将回滚到 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(" 的制品，回滚即将进行"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_id")]),s._v('"')]),s._v(" /root/.jenkins/version/$project/version.log"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        ssh -p '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -snf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行回滚时出错，故而退出构建，可立即联系运维同学处理！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n        echoGreen "')]),s._v("项目回滚到 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' 完成！"\n    '),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br")])]),t("p",[s._v("核心部分也就是脚本内容了，以上即是脚本内容，采用的逻辑也都比较容易理解，只要读一下就能理解，可用于生产，可能只需要调整一下几个变量，或者路径就可以直接投入使用。")]),s._v(" "),t("h2",{attrs:{id:"_3-自由风格结合ansible多机批量部署回滚示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-自由风格结合ansible多机批量部署回滚示例"}},[s._v("#")]),s._v(" 3，自由风格结合ansible多机批量部署回滚示例")]),s._v(" "),t("p",[s._v("自由风格之下，同样首先创建对应的参数用于传递，然后这里又新增了一个参数用于传递远程主机，以实现单机或者批量发布都可的功能。")]),s._v(" "),t("p",[s._v("依旧是先定于参数如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/a2d1313601cbc5e3.jpg",alt:"image"}})]),s._v(" "),t("p",[s._v("然后定义脚本如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##set color##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("echoRed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;31m'")]),s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoGreen() { echo $'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;32m'\"")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoYellow() { echo $'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;33m'\"")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\n##set color##\nsource /etc/profile\nproject=\"")]),s._v("tale"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_port="')]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_user="')]),s._v("root"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nproject_dir="')]),s._v("/data/www/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nversion_dir="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Date}")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"\ncat > keepfive.sh << 'EOF'\nfile_path=\"")]),s._v("/release/tale"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nwhile true;do\nA='),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nB="),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lrX $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nif [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" -gt 5 ];then rm -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_path}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$B")]),s._v(";else break;fi;done\nEOF\ncat > excludefile << EOF\nhosts.ini\ndeploy.yml\nJenkinsfile\nkeepfive.sh\nexcludefile\nEOF\nRs(){\nif [ "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' == "')]),s._v("all"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\ncat > hosts.ini << EOF\n[remote]\n10.3.9.32 ansible_port=34222\n10.3.20.4 ansible_port=34222\nEOF\nelse\ncat > hosts.ini << EOF\n[remote]\n'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' ansible_port=34222\nEOF\nfi\n}\nRb(){\ncat > rollback.yml << EOF\n---\n- hosts: "')]),s._v("remote"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  remote_user: root\n  tasks:\n    - name: "')]),s._v("将项目回滚到对应期望的构建"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/data/www/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" state=link src="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Version}")]),s._v('\nEOF\n}\nRd(){\ncat > deploy.yml << EOF\n---\n- hosts: "')]),s._v("remote"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  remote_user: root\n  tasks:\n    - name: "')]),s._v("创建远程主机上的版本目录"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/release/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v(' state=directory\n    - name: "')]),s._v("将代码同步到远程主机版本目录"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      synchronize: \n        src: '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/ \n        dest: /release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v('/  \n        rsync_opts: --exclude-from=excludefile\n    - name: "')]),s._v("将项目部署到生产目录"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/data/www/'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" state=link src=/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v('\n    - name: "')]),s._v("使版本目录保持五个版本历史"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      script: keepfive.sh\n    - name: "')]),s._v("生成远程版本号"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      shell: "')]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /release/version.log"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    - name: "')]),s._v("同步版本号到本地"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      synchronize: "')]),s._v("src"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/release/version.log "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.jenkins/version/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/version.log "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pull"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nEOF\n}\nif [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mode")]),s._v(' == "')]),s._v("deploy"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n    Rs && Rd\n    ansible-playbook -i hosts.ini deploy.yml\nelse\n    if [ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' == "')]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n        Rs\n        echo "')]),s._v("选择回滚的版本是默认，将回滚到上次制品，回滚即将进行"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -n2 /root/.jenkins/version/$project/version.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -n1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Rb\n        ansible-playbook -i hosts.ini rollback.yml\n        echo "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echo "')]),s._v("项目已回滚完成！"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echo "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    else\n        Rs\n        echo "')]),s._v("选择回滚的版本是："),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v("，将回滚到 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(" 的制品，回滚即将进行"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_id")]),s._v('"')]),s._v(" /root/.jenkins/version/$project/version.log"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Rb\n        ansible-playbook -i hosts.ini rollback.yml\n        echo "')]),s._v("项目回滚到 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' 完成！"\n    '),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br")])]),t("p",[s._v("这里把所有内容都集成到一个脚本，便于维护管理。这是我现在比较推崇的一种配置习惯，日常使用过程中，可能我们经常需要调试一些东西，如果一个构建调用的脚本要放好几个地方，那么维护起来是非常痛苦的，莫不如直接全部都集成在Jenkins当中，任何时候需要排查某个项目，直接到Jenkins中打开配置查看即可，而不需要再找几个地方。")]),s._v(" "),t("p",[s._v("如上两种方式都是紧贴合文章开头的流程图所为，也就几个大佬口中简单的if/else而已，但是就已经足够满足并实现我们的需求了。")])])}),[],!1,null,null,null);"function"==typeof n&&n(r);a.default=r.exports}}]);
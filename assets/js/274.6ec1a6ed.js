(window.webpackJsonp=window.webpackJsonp||[]).push([[274],{837:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("logstash的时间格式问题，是一个老大难，当然，这种难往往来自于那种日志输出不规范的情况，尤其是时间戳，各种各样的，最终来到配置这一环节的时候，就要费很大的劲儿来调配这个东东。")]),t._v(" "),a("p",[t._v("所以，在立项新项目的时候，首先就需要约束好日志的格式，严格按照日志规范来走。")]),t._v(" "),a("p",[t._v("本文就来整理一下在配置logstash的时候，遇到时间格式的问题，所需要用到的，注意到的配置细节。")]),t._v(" "),a("h2",{attrs:{id:"_1-date-filter-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-date-filter-插件"}},[t._v("#")]),t._v(" 1，Date Filter 插件")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("日期过滤器"),a("OutboundLink")],1),t._v("用于分析字段中的日期，然后使用该日期或时间戳作为事件的logstash时间戳。")]),t._v(" "),a("h2",{attrs:{id:"_2-配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置项"}},[t._v("#")]),t._v(" 2，配置项")]),t._v(" "),a("p",[t._v("该插件支持以下配置选项：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Setting")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Input type")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Required")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Default")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("locale")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("match")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("[]")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("tag_on_failure")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v('["_dateparsefailure"]')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("target")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v('"@timestamp"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("timezone")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("No")])])])]),t._v(" "),a("p",[t._v("接下来逐一详解各配置含义。")]),t._v(" "),a("h3",{attrs:{id:"_1-locate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-locate"}},[t._v("#")]),t._v(" 1，locate")]),t._v(" "),a("p",[t._v("值类型是字符串,这个设置没有默认值。使用IETF-BCP47或POSIX语言标记指定用于日期分析的区域设置。 简单的例子是en，美国的BCP47或者en_US的POSIX。大多数情况下需要设置语言环境来解析月份名称（MMM模式）和星期几名称（EEE模式）。如果未指定，则将使用平台默认值，但对于非英文平台默认情况下，英文解析器也将用作回退机制。")]),t._v(" "),a("h3",{attrs:{id:"_2-match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-match"}},[t._v("#")]),t._v(" 2，match")]),t._v(" "),a("p",[t._v("用于配置具体的匹配内容规则，前半部分内容表示匹配实际日志当中的时间戳的名称，后半部分则用于匹配实际日志当中的时间戳格式，这个地方是整条配置的核心内容，如果此处规则匹配是无效的，则生成后的日志时间戳将会被读取的时间替代。")]),t._v(" "),a("p",[t._v("这里列出一些常见的日志中时间格式的匹配规则，亲测可以直接放到实际中使用：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("时间戳")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("match")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("2018-06-01T01:23:05+08:00")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("yyyy-MM-dd'T'HH:mm:ss+08:00")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("2018-06-01T01:23:05Z")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("yyyy-MM-dd'T'HH:mm:ssZ")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Jun 07 2018 01:23:05")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v('MMM dd yyyy HH:mm:ss (注: locale => "en")')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Jun 7 2018 01:23:05")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v('MMM d yyyy HH:mm:ss (注: locale => "en")')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("1529122935988")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("UNIX_MS")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("1529122935")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("UNIX")])])])]),t._v(" "),a("p",[t._v("这块儿内容在最后会专门用实际例子进行说明。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("date插件支持五种时间格式")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ISO8601")]),t._v("\n属于标准格式，类似 "),a("code",[t._v('"2018-06-17T03:44:01.103Z"')]),t._v(" 这样的格式。具体Z后面可以有 "),a("code",[t._v('"08:00"')]),t._v("也可以没有，"),a("code",[t._v('".103"')]),t._v("这个也可以没有。常用场景里来说，"),a("code",[t._v("Nginx")]),t._v(" 的 "),a("code",[t._v("log_format")]),t._v(" 配置里就可以使用 "),a("code",[t._v("$time_iso8601")]),t._v(" 变量来记录请求时间成这种格式。")]),t._v(" "),a("li",[a("code",[t._v("UNIX")]),t._v("\nUNIX 时间戳格式，记录的是从 1970 年起始至今的总秒数。Squid 的默认日志格式中就使用了这种格式。")]),t._v(" "),a("li",[a("code",[t._v("UNIX_MS")]),t._v("\n这个时间戳则是从 1970 年起始至今的总毫秒数。据我所知，JavaScript 里经常使用这个时间格式。")]),t._v(" "),a("li",[a("code",[t._v("TAI64N")]),t._v("\nTAI64N 格式比较少见，是这个样子的：@4000000052f88ea32489532c。我目前只知道常见应用中，qmail 会用这个格式。")]),t._v(" "),a("li",[a("code",[t._v("Joda-Time 库")]),t._v("\nLogstash 内部使用了 Java 的 "),a("a",{attrs:{href:"http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Joda时间库"),a("OutboundLink")],1),t._v("来作时间处理。所以我们可以使用Joda库所支持的时间格式来作具体定义。")])])]),t._v(" "),a("li",[a("p",[t._v("时间戳详解")]),t._v(" "),a("p",[t._v("用于解析日期和时间文本的语法使用字母来指示时间值（月，分等）的类型，以及重复的字母来表示该值的形式（2位月份，全月份名称等）。以下是可用于解析日期和时间的内容：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("y")]),t._v("(year)")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yyyy  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全年号码。 例如：2015。")]),t._v("\nyy    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数年份。 例如：2015年的15。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("M")]),t._v(" (month of the year)")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("M     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小数字月份。 例如：1 for January and 12 for December.。")]),t._v("\nMM    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数月份。 如果需要，填充零。 例如：01 for January  and 12 for Decembe")]),t._v("\nMMM   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#缩短的月份文本。 例如： Jan for January。 注意：使用的语言取决于您的语言环境。 请参阅区域设置以了解如何更改语言。")]),t._v("\nMMMM  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全月文本，例如：January。 注意：使用的语言取决于您的语言环境。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("d")]),t._v(" (day of the month)")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("d   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最少数字的一天。 例如：1月份的第一天1。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数的日子，如果需要的话可以填零.例如：01 for the 1st of the month。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("H")]),t._v("  (hour of the day (24-hour clock))")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("H   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小数字小时。 例如:0表示午夜。")]),t._v("\nHH  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数小时，如果需要填零。 例如：午夜00。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("m")]),t._v(" (minutes of the hour (60 minutes per hour))")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("m   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小的数字分钟。 例如：0。")]),t._v("\nmm  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数分钟，如果需要填零。 例如：00。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("s")]),t._v(" (seconds of the minute (60 seconds per minute) )")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("s    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小数字秒。 例如：0。")]),t._v("\nss   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#两位数字，如果需要填零。 例如：00。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("S")]),t._v(" 秒的小数部分最大精度是毫秒（SSS）。 除此之外，零附加。")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("S    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#十分之一秒。例如：0为亚秒值012")]),t._v("\nSS   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#百分之一秒 例如：01为亚秒值01")]),t._v("\nSSS  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#千分之一秒 例如：012为亚秒值012")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("Z 时区偏移或身份")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("Z   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#时区偏移，结构为HHmm（Zulu/UTC的小时和分钟偏移量）。例如：-0700。")]),t._v("\nZZ  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#时区偏移结构为HH:mm（小时偏移和分钟偏移之间的冒号）。 例如：-07：00。")]),t._v("\nZZZ  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#时区身份。 例如：America/Los_Angeles。 注意：有效的ID在列表中列出http://joda-time.sourceforge.net/timezones.html")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])])])])]),t._v(" "),a("p",[t._v("其他不常用的就不再详录了，诸上之外的，可参考：http://www.joda.org/joda-time/key_format.html")]),t._v(" "),a("h3",{attrs:{id:"_3-tag-on-failure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-tag-on-failure"}},[t._v("#")]),t._v(" 3，tag_on_failure")]),t._v(" "),a("p",[t._v("如果匹配失败，将值附加到tag字段，字段值为 "),a("code",[t._v("_dateparsefailure")]),t._v("，有时候我们在kibana当中看到日志会有这个字段，那么不用多想了，一定是时间格式匹配失败了，需要重新检查上边的match配置解析是否正确。")]),t._v(" "),a("h3",{attrs:{id:"_4-target"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-target"}},[t._v("#")]),t._v(" 4，target")]),t._v(" "),a("p",[t._v("将匹配的时间戳存储到给定的目标字段中。如果未提供，则默认更新事件的@timestamp字段。一般情况下，我们用的配置如下：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("filter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   date "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      match        => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNIX"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyy-MM-dd HH:mm:ss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd-MMM-yyyy HH:mm:ss"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      target       => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("此处配置的意思是，match对原始日志时间格式进行解析，解析之后，存储到下边定义的target定义的字段中，一般这个字段肯定是 "),a("code",[t._v("@timestamp")]),t._v("，而又因为默认字段就是"),a("code",[t._v("@timestamp")]),t._v("，因此这个字段可以省略，配置如下，效果一样。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("filter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   date "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      match        => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNIX"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyy-MM-dd HH:mm:ss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd-MMM-yyyy HH:mm:ss"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h3",{attrs:{id:"_5-timezone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-timezone"}},[t._v("#")]),t._v(" 5，timezone")]),t._v(" "),a("p",[t._v("当需要配置的date里面没有时区信息,而且不是UTC时间,需要设置timezone参数。\n比如匹配北京时间 "),a("code",[t._v('"2018-06-18 11:10:00"')]),t._v("，则需要设置")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("date "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    match => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"logdate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyy-MM-dd HH:mm:ss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("    timezone => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Asia/Chongqing"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("东八区")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Standard Offset")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Canonical ID")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Aliases")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("+08:00")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Asia/Chongqing")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Asia/Chungking")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("+08:00")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Asia/Hong_Kong")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Hongkong")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("+08:00")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Asia/Shanghai")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("PRC")])])])]),t._v(" "),a("p",[t._v("附: "),a("a",{attrs:{href:"http://joda-time.sourceforge.net/timezones.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("timezone列表"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/e3337746c7035bdb.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_3-几个解析实战-重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-几个解析实战-重点"}},[t._v("#")]),t._v(" 3，几个解析实战（重点）")]),t._v(" "),a("h3",{attrs:{id:"_1-标准格式iso8601"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-标准格式iso8601"}},[t._v("#")]),t._v(" 1，标准格式"),a("code",[t._v("ISO8601")])]),t._v(" "),a("p",[t._v("如果日志的格式是如上说明的这种标准格式，那么这种日志出来是最省事儿的，不需要进行额外的解析，直接拿来使用即可，最常见的案例就是NGINX的日志了。")]),t._v(" "),a("h4",{attrs:{id:"_1-原始日志。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。"}},[t._v("#")]),t._v(" 1，原始日志。")]),t._v(" "),a("p",[t._v("一般情况下，我们会把NGINX日志json化，关于时间戳的配置，都是这样：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@timestamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$time_iso8601"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("然后输出的日志如下：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@timestamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-10-12T21:57:40+08:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.16.241.250"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"request_method"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientip"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"42.236.99.65"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26977")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"responsetime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.258")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"upstreamtime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.258"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"upstreamhost"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unix:/tmp/php-cgi.sock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"http_host"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wiki.eryajf.net"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/index.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"xff"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"referer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://wiki.eryajf.net/pages/2217.html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"agent"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.4.2661.102 Safari/537.36; 360Spider"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("那么这种日志，就不需要添加data插件进行解析，刨除其他特殊解析之外，直接进行输入输出即可，测试效果如下。")]),t._v(" "),a("h4",{attrs:{id:"_2-配置文件。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。"}},[t._v("#")]),t._v(" 2，配置文件。")]),t._v(" "),a("p",[t._v("此时可用如下配置文件：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("input "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tpath \t\t\t=> "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\tcodec \t\t\t=> "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tstdout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tcodec => rubydebug\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h4",{attrs:{id:"_3-测试效果。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。"}},[t._v("#")]),t._v(" 3，测试效果。")]),t._v(" "),a("p",[t._v("此时利用rubydebug，查看控制台输出效果：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"referer"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://wiki.eryajf.net/pages/2217.html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.16.241.250"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"agent"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.4.2661.102 Safari/537.36; 360Spider"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-10")]),t._v("-12T13"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("57")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(".000Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xff"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clientip"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"42.236.99.65"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"url"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/index.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"upstreamtime"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.258"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"size"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26977")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http_host"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wiki.eryajf.net"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@version"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"request_method"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"responsetime"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.258")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"upstreamhost"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unix:/tmp/php-cgi.sock"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("p",[t._v("此时可以看到，我们没有针对原始日志进行任何解析操作，原始日志中的"),a("code",[t._v("@timestamp")]),t._v("字段就自动被logstash识别作为了日志的"),a("code",[t._v("@timestamp")]),t._v("，非常方便便捷，而且在这一层也少了解析的步骤，对logstash负载是大有好处的，因此我们鼓励开发者使用这种标准格式进行日志的输出打印，当这成为一个标准之后，一切就显得优雅了。")]),t._v(" "),a("h3",{attrs:{id:"_2-带-t模式。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-带-t模式。"}},[t._v("#")]),t._v(" 2，带 "),a("code",[t._v("T")]),t._v("模式。")]),t._v(" "),a("p",[t._v("我也不知道这种日志具体的格式名称，总之它的特征就是在时间戳里边有一个 "),a("code",[t._v("T")]),t._v("，这个"),a("code",[t._v("T")]),t._v("并不代表任何含义，仅仅作为一个时间戳隔离的无含义字段，因此我们在解析的时候，也可以将其无含义对待，直接套用即可。")]),t._v(" "),a("h4",{attrs:{id:"_1-原始日志。-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-2"}},[t._v("#")]),t._v(" 1，原始日志。")]),t._v(" "),a("p",[t._v("这个一般是开发者定义时间格式，然后输出的日志如下：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{"timestamp":"2019-10-10T15:37:08+08:00","level":"info","message":"这是一条测试日志"}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("套用上边表格里边的内容，直接引用后边的match配置即可。")]),t._v(" "),a("h4",{attrs:{id:"_2-配置文件。-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-2"}},[t._v("#")]),t._v(" 2，配置文件。")]),t._v(" "),a("p",[t._v("此时可用如下配置文件：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("input "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tpath \t\t\t=> "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\tcodec \t\t\t=> "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfilter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t# 直接将T作为一个占位符，后边的时间也是，不过可以用Z代替\n\t\tmatch => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"yyyy-MM-dd'T'HH:mm:ss+08:00\"")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tstdout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tcodec => rubydebug\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("h4",{attrs:{id:"_3-测试效果。-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-2"}},[t._v("#")]),t._v(" 3，测试效果。")]),t._v(" "),a("p",[t._v("此时利用rubydebug，查看控制台输出效果：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@version"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost.localdomain"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"level"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"info"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-10-10T15:37:08+08:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-10")]),t._v("-10T07"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("37")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("08")]),t._v(".000Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"这是一条测试日志"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("生产当中，如果日志格式与上边例子一致，那么配置也是可以直接复用的，如果有出入，则应该根据实际情况进行特殊配置。")]),t._v(" "),a("h3",{attrs:{id:"_3-业务日志。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-业务日志。"}},[t._v("#")]),t._v(" 3，业务日志。")]),t._v(" "),a("p",[t._v("有一些应用的日志，或者业务的日志，时间格式极其不标准，各有各的想法，各有各的的模样，就像西游记里边长的各色各样的小妖一般，这种的处理起来就有点棘手了，需要借助于grok插件来进行处理。")]),t._v(" "),a("h4",{attrs:{id:"_1-原始日志。-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-3"}},[t._v("#")]),t._v(" 1，原始日志。")]),t._v(" "),a("p",[t._v("这种就千奇百怪了，这里举一个例子，算是抛砖引玉，遇到一些相对特殊的，可以自行匹配转换，输出的日志如下：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-09-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":35:30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ---.INFO: "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),t._v(":0,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nowTime"')]),t._v(":1565948130,"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),t._v(":0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-配置文件。-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-3"}},[t._v("#")]),t._v(" 2，配置文件。")]),t._v(" "),a("p",[t._v("此时可用如下配置文件：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("input "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    codec       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfilter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  grok "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    match         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\[%{YEAR:year}-%{MONTHNUM:month}-%{MONTHDAY:day} %{TIME:time}\\]%{GREEDYDATA}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    add_field     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%{year}-%{month}-%{day} %{time}"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    remove_field  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"day"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"month"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"year"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"time"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    match         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v(" , "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNIX"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyy-MM-dd HH:mm:ss"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd-MMM-yyyy HH:mm:ss"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    target        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v("\n    remove_field  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  stdout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    codec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rubydebug\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("p",[t._v("说明，这个地方，有必要用我个人理解到的，进行一下讲解，很多人都在分享着各种各样的配置，几乎从来没有人用通俗的话讲配置解析一下，而这样的事儿，恰恰又是我喜欢做的，因为这样在别人看到这里的时候，会更加容易有真实的收获。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("grok")]),t._v(" "),a("p",[t._v("将非结构化事件数据分析到字段中。 这个工具非常适用于系统日志，Apache和其他网络服务器日志，MySQL日志，以及通常为人类而不是计算机消耗的任何日志格式。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("match")]),t._v(" "),a("p",[t._v("这个概念不必介绍了，但是内部的意思值得说明一下，表示将整条日志放入到message这一字段中，其中，时间戳逐个匹配，匹配到的赋值给 "),a("code",[t._v('"day", "month", "year", "time"')]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("add_field")]),t._v(" "),a("p",[t._v("添加一个字段timestamp，来承接刚刚解析的时间戳。即将"),a("code",[t._v('"day", "month", "year", "time"')]),t._v("赋值g诶timestamp。")])]),t._v(" "),a("li",[a("p",[t._v("remove_field")]),t._v(" "),a("p",[t._v("当解析到的字段已经赋值给了新的字段，那么原来解析到的"),a("code",[t._v('"day", "month", "year", "time"')]),t._v("就可以丢掉了。")])])])]),t._v(" "),a("li",[a("p",[t._v("date")]),t._v(" "),a("p",[t._v("再往下就比较熟悉了，不必多介绍了，也是本文一直在讲解的内容。")])])]),t._v(" "),a("h4",{attrs:{id:"_3-测试效果。-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-3"}},[t._v("#")]),t._v(" 3，测试效果。")]),t._v(" "),a("p",[t._v("此时利用rubydebug，查看控制台输出效果：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@version"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost.localdomain"')]),t._v(",\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[2019-09-17 17:35:30] ---.INFO: ===:{'),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("code"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(":0,"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(":"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("nowTime"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(":1565948130,"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("data"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(':0}"')]),t._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-09-17T09:35:30.000Z\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("这里的输出中，我们可以清晰看到，"),a("code",[t._v("timestamp")]),t._v("输出的时间，与原始日志中的时间是一致的，而且没有"),a("code",[t._v("_dateparsefailure")]),t._v("这个出现，说明解析规则是成功的。")]),t._v(" "),a("h3",{attrs:{id:"_4-系统日志message。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-系统日志message。"}},[t._v("#")]),t._v(" 4，系统日志message。")]),t._v(" "),a("p",[t._v("有时候可能还需要采集系统的message日志，用于记录一些与系统相关的日志记录。")]),t._v(" "),a("h4",{attrs:{id:"_1-原始日志。-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-4"}},[t._v("#")]),t._v(" 1，原始日志。")]),t._v(" "),a("p",[t._v("Linux系统日志输出如下：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":01:01 localhost systemd: Starting Session "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" of user root.\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-配置文件。-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-4"}},[t._v("#")]),t._v(" 2，配置文件。")]),t._v(" "),a("p",[t._v("此时可用如下配置文件：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("input "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tpath \t\t\t=> "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfilter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgrok "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmatch  => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),t._v(" => "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%{SYSLOGLINE}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tdate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmatch => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MMM dd HH:mm:ss"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tmutate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tremove_field => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timestamp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tstdout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tcodec => rubydebug\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("h4",{attrs:{id:"_3-测试效果。-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-4"}},[t._v("#")]),t._v(" 3，测试效果。")]),t._v(" "),a("p",[t._v("此时利用rubydebug，查看控制台输出效果：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Oct 10 23:01:01 localhost systemd: Starting Session 9 of user root."')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting Session 9 of user root."')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"program"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),t._v(",\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/log/test.log"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@timestamp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("-10-10T15:01:01.000Z,\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost.localdomain"')]),t._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@version"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n     "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"logsource"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[t._v("这个配置，是借助于elk已经给出的一个插件 "),a("code",[t._v("%{SYSLOGLINE}")]),t._v("来完成，配置起来还是比较简便的。")]),t._v(" "),a("p",[t._v("好了，实际生产中实战的例子就举这么几个吧，常规的基本上都可用，如有其它比较特殊的，那么结合grok进行匹配即可。")]),t._v(" "),a("h2",{attrs:{id:"_4-时区问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-时区问题"}},[t._v("#")]),t._v(" 4，时区问题")]),t._v(" "),a("p",[t._v("很多中国用户经常提一个问题：为什么 "),a("code",[t._v("@timestamp")]),t._v(" 比我们早了 8 个小时？怎么修改成北京时间？")]),t._v(" "),a("p",[t._v("其实，Elasticsearch 内部(有相当多的软件，都是)，对时间类型字段，是统一采用 UTC 时间，存成 long 长整形数据的！对日志统一采用 UTC 时间存储，是国际安全/运维界的一个通识——欧美公司的服务器普遍广泛分布在多个时区里——不像中国，地域横跨五个时区却只用北京时间。")]),t._v(" "),a("p",[t._v("对于页面查看，ELK 的解决方案是在 Kibana 上，读取浏览器的当前时区，然后在页面上转换时间内容的显示。")]),t._v(" "),a("p",[t._v('所以，建议大家接受这种设定。否则，即便你用 .getLocalTime 修改，也还要面临在 Kibana 上反过去修改，以及 Elasticsearch 原有的 ["now-1h" TO "now"] 这种方便的搜索语句无法正常使用的尴尬。')])])}),[],!1,null,null,null);s.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[291],{853:function(s,t,e){"use strict";e.r(t);var a=e(11),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("上面的那一堆都是准备工作，下面开始正式部署 kubernetes 了。")]),s._v(" "),e("p",[s._v("本节在 master 节点进行部署。")]),s._v(" "),e("h2",{attrs:{id:"_1-下载安装文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载安装文件"}},[s._v("#")]),s._v(" 1，下载安装文件")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://dl.k8s.io/v1.8.6/kubernetes-server-linux-amd64.tar.gz")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -xzvf kubernetes-server-linux-amd64.tar.gz")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r kubernetes/server/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,kube-proxy,kubelet} /usr/local/bin/")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_2-配置和启动-kube-apiserver"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置和启动-kube-apiserver"}},[s._v("#")]),s._v(" 2，配置和启动 kube-apiserver")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-apiserver.service "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=network.target\nAfter=etcd.service\n \n[Service]\nExecStart=/usr/local/bin/kube-apiserver "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,NodeRestriction "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --advertise-address=192.168.106.3 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --bind-address=192.168.106.3 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --insecure-bind-address=127.0.0.1 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --authorization-mode=Node,RBAC "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --runtime-config=rbac.authorization.k8s.io/v1alpha1 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --kubelet-https=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --enable-bootstrap-token-auth "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --token-auth-file=/etc/kubernetes/token.csv "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-cluster-ip-range=10.254.0.0/16 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-node-port-range=8400-10000 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --client-ca-file=/etc/kubernetes/ssl/ca.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-cafile=/etc/kubernetes/ssl/ca.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-servers=https://192.168.106.3:2379,https://192.168.106.4:2379,https://192.168.106.5:2379 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --enable-swagger-ui=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --allow-privileged=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --apiserver-count=3 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxage=30 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxbackup=3 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxsize=100 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-path=/var/lib/audit.log "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --event-ttl=1h "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nRestartSec=5\nType=notify\nLimitNOFILE=65536\n \n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br")])]),e("p",[s._v("注意：更换成自己的 IP。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("--authorization-mode"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RBAC ：指定在安全端口使用 RBAC 授权模式，拒绝未通过授权的请求；\nkube-scheduler、kube-controller-manager ：一般和 kube-apiserver 部署在同一台机器上，它们使用非安全端口和 kube-apiserver通信"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nkubelet、kube-proxy、kubectl ：部署在其它 Node 节点上，如果通过安全端口访问 kube-apiserver，则必须先通过 TLS 证书认证，再通过 RBAC 授权； \nkube-proxy、kubectl ：通过在使用的证书里指定相关的 User、Group 来达到通过 RBAC 授权的目的； \n如果使用了 kubelet TLS Boostrap 机制，则不能再指定 –kubelet-certificate-authority、–kubelet-client-certificate 和 –kubelet-client-key 选项，否则后续 kube-apiserver 校验 kubelet 证书时出现 ”x509: certificate signed by unknown authority“ 错误； \n--admission-control ：值必须包含 ServiceAccount，否则部署集群插件时会失败；\n--bind-address ：不能为 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1； \n--runtime-config：配置为rbac.authorization.k8s.io/v1beta1，表示运行时的apiVersion；\n--service-cluster-ip-range： 指定 Service Cluster IP 地址段，该地址段不能路由可达； \n--service-node-port-range ：指定 NodePort 的端口范围； \n缺省情况下 kubernetes 对象保存在 etcd /registry 路径下，可以通过 –etcd-prefix 参数进行调整；\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"_3-启动-kube-apiserver"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动-kube-apiserver"}},[s._v("#")]),s._v(" 3，启动 kube-apiserver")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-apiserver.service /etc/systemd/system/")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-apiserver")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-apiserver")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-apiserver")]),s._v("\n \n \nkube-apiserver.service - Kubernetes API Server\n   Loaded: loaded "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/kube-apiserver.service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since 一 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-03-19 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:03 CST"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 19s ago\n     Docs: https://github.com/GoogleCloudPlatform/kubernetes\n Main PID: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/kube-apiserver.service\n           └─5948 /usr/local/bin/kube-apiserver --logtostderr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true --admission-control"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,NodeRestriction --advertise-address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.901059    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /api/v1/namespaces: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(".166039ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.914750    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-system/rolebindings: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".722228ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("201")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kub"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.915229    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" storage_rbac.go:287"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" created rolebinding.rbac.authorization.k8s.io/system:controller:token-cleaner "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" kube-system\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.929618    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-public/rolebindings/system:controller:bootst"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.935152    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /api/v1/namespaces: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".882855ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("161.161")]),s._v(":60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.965294    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-public/rolebindings: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".302393ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("201")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ku"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.965805    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" storage_rbac.go:287"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" created rolebinding.rbac.authorization.k8s.io/system:controller:bootstrap-signer "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" kube-public\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.776733    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".511793ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.780367    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default/services/kubernetes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".593409ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd6"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.784057    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default/endpoints/kubernetes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".67392ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd6"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nHint: Some lines were ellipsized, use -l to show "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" full.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("h2",{attrs:{id:"_4-配置和启动-kube-controller-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置和启动-kube-controller-manager"}},[s._v("#")]),s._v(" 4，配置和启动 kube-controller-manager")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-controller-manager.service "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes Controller Manager\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\n \n[Service]\nExecStart=/usr/local/bin/kube-controller-manager "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true  "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --address=127.0.0.1 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --master=http://127.0.0.1:8080 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --allocate-node-cidrs=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-cluster-ip-range=10.254.0.0/16 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-cidr=172.30.0.0/16 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-name=kubernetes "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --root-ca-file=/etc/kubernetes/ssl/ca.pem "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --leader-elect=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nLimitNOFILE=65536\nRestartSec=5\n \n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("--address ：值必须为 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1，因为当前 kube-apiserver 期望 scheduler 和 controller-manager 在同一台机器；\n--master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MASTER_IP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":8080：使用非安全 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" 端口与 kube-apiserver 通信； \n--cluster-cidr： 指定 Cluster 中 Pod 的 CIDR 范围，该网段在各 Node 间必须路由可达"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flanneld保证"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("； \n--service-cluster-ip-range： 参数指定 Cluster 中 Service 的CIDR范围，该网络在各 Node 间必须路由不可达，必须和 kube-apiserver 中的参数一致； \n--cluster-signing-*： 指定的证书和私钥文件用来签名为 TLS BootStrap 创建的证书和私钥； \n--root-ca-file ：用来对 kube-apiserver 证书进行校验，指定该参数后，才会在Pod 容器的 ServiceAccount 中放置该 CA 证书文件； \n--leader-elect"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true： 部署多台机器组成的 master 集群时选举产生一处于工作状态的 kube-controller-manager 进程；\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"_5-启动-kube-controller-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动-kube-controller-manager"}},[s._v("#")]),s._v(" 5，启动 kube-controller-manager")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-controller-manager.service /etc/systemd/system/")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-controller-manager")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-controller-manager")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-controller-manager")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"_6-配置和启动-kube-scheduler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置和启动-kube-scheduler"}},[s._v("#")]),s._v(" 6，配置和启动 kube-scheduler")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-scheduler.service "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes Scheduler\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\n \n[Service]\nExecStart=/usr/local/bin/kube-scheduler "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --address=127.0.0.1 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --master=http://127.0.0.1:8080 "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --leader-elect=true "),e("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nLimitNOFILE=65536\nRestartSec=5\n \n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("--address 值必须为 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1，因为当前 kube-apiserver 期望 scheduler 和 controller-manager 在同一台机器； \n--master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MASTER_IP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":8080：使用非安全 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" 端口与 kube-apiserver 通信； \n--leader-elect"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true 部署多台机器组成的 master 集群时选举产生一处于工作状态的 kube-controller-manager 进程；\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"_7-启动-kube-scheduler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动-kube-scheduler"}},[s._v("#")]),s._v(" 7，启动 kube-scheduler")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-scheduler.service /etc/systemd/system/")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-scheduler")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-scheduler")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-scheduler")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"_8-验证-master-节点功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-验证-master-节点功能"}},[s._v("#")]),s._v(" 8，验证 master 节点功能")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get cs")]),s._v("\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-0               Healthy   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd-2               Healthy   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \netcd-1               Healthy   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);